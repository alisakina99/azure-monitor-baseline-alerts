{
  "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json#",
  "view": {
    "kind": "Form",
    "properties": {
      "title": "Azure landing zone accelerator",
      "steps": [
        {
          "name": "basics",
          "label": "Deployment settings",
          "elements": [
            {
              "name": "cloudEnvironment",
              "type": "Microsoft.Common.Section",
              "label": "Select cloud environment",
              "elements": [
                {
                  "name": "selection",
                  "type": "Microsoft.Common.DropDown",
                  "visible": true,
                  "label": "Azure cloud environment",
                  "defaultValue": "[if(contains(steps('basics').resourceScope.location.name, 'china'), 'Azure China Cloud', if(contains(steps('basics').resourceScope.location.name, 'usgov'), 'Azure US Government', if(contains(steps('basics').resourceScope.location.name, 'usdod'), 'Azure US Government', 'Azure Cloud')))]",
                  "multiselect": false,
                  "selectAll": false,
                  "filter": false,
                  "multiLine": true,
                  "toolTip": "Select your target Azure cloud environment.",
                  "constraints": {
                    "allowedValues": [
                      {
                        "label": "Azure Cloud",
                        "value": "AzureCloud"
                      },
                      {
                        "label": "Azure China Cloud",
                        "value": "AzureChinaCloud"
                      },
                      {
                        "label": "Azure US Government",
                        "value": "AzureUSGovernment"
                      }
                    ]
                  }
                },
                {
                  "name": "warning",
                  "type": "Microsoft.Common.InfoBox",
                  "visible": true,
                  "options": {
                    "icon": "Warning",
                    "text": "This value should be automatically set based on the list of available locations. Only change this if you believe the value to be incorrect.",
                    "uri": "https://docs.microsoft.com/en-us/cli/azure/manage-clouds-azure-cli"
                  }
                }
              ]
            },
            {
              "name": "resourceScope",
              "type": "Microsoft.Common.ResourceScope"
            },
            {
              "name": "getSubscriptions",
              "type": "Microsoft.Solutions.ArmApiControl",
              "request": {
                "method": "POST",
                "path": "providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",
                "body": {
                  "query": "ResourceContainers | where type =~ 'microsoft.resources/subscriptions' | where properties.state =~ 'enabled' | project label=tostring(name), description=subscriptionId, value=subscriptionId | order by label asc"
                }
              }
            },
            {
              "name": "getLocations",
              "type": "Microsoft.Solutions.ArmApiControl",
              "request": {
                "method": "GET",
                "path": "locations?api-version=2019-11-01"
              }
            }
          ]
        },
        {
          "name": "monitor",
          "label": "Baseline alerts and monitoring",
          "subLabel": {
            "preValidation": "",
            "postValidation": ""
          },
          "bladeTitle": "ALZ - Baseline Alerts",
          "elements": [
            {
              "name": "baselinealertsintro",
              "type": "Microsoft.Common.InfoBox",
              "visible": true,
              "options": {
                "text": "Azure Landing Zones will create ARM automation to deploy baseline alerts automatically as resources are deployed. Note that selecting Yes to the Option 'Deploy one or more Azure Monitor Baseline Alerts', will automatically import all policies and initiatives and will assign the Deploy Azure Monitor Baseline Alerts for Service Health policy initiative at the intermediate root.",
                "uri": "https://aka.ms/amba/alz/docs",
                "style": "Info"
              }
            },
            {
              "name": "alertName",
              "type": "Microsoft.Common.TextBox",
              "label": "Alert Name",
              "subLabel": "",
              "defaultValue": "",
              "toolTip": "Name of the alert",
              "constraints": {
                "required": true,
                "regex": "",
                "validationMessage": "",
                "validations": [
                  {
                    "isValid": "[or(                                or(    empty(basics('alertName')),     and(        not(startsWith(basics('alertName'), '[[')),         startsWith(basics('alertName'), '['), endsWith(basics('alertName'), ']'),         greater(indexOf(basics('alertName'), '('), -1), greater(indexOf(basics('alertName'), ')'), -1)        )    ),                                greaterOrEquals(length(basics('alertName')), 1)                                )]",
                    "message": "The value must have a length of at least 1."
                  }
                ]
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "alertDescription",
              "type": "Microsoft.Common.TextBox",
              "label": "Alert Description",
              "subLabel": "",
              "defaultValue": "Memory. Range 0-25 GB for S1, 0-50 GB for S2 and 0-100 GB for S4",
              "toolTip": "Description of alert",
              "constraints": {
                "required": false,
                "regex": "",
                "validationMessage": "",
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "targetResourceId",
              "type": "Microsoft.Common.TextBox",
              "label": "Target Resource Id",
              "subLabel": "",
              "defaultValue": "",
              "toolTip": "List of Azure resource Ids seperated by a comma. For example - /subscriptions/00000000-0000-0000-0000-0000-00000000/resourceGroup/resource-group-name/Microsoft.compute/virtualMachines/vm-name",
              "constraints": {
                "required": true,
                "regex": "",
                "validationMessage": "",
                "validations": [
                  {
                    "isValid": "[or(                                or(    empty(basics('targetResourceId')),     and(        not(startsWith(basics('targetResourceId'), '[[')),         startsWith(basics('targetResourceId'), '['), endsWith(basics('targetResourceId'), ']'),         greater(indexOf(basics('targetResourceId'), '('), -1), greater(indexOf(basics('targetResourceId'), ')'), -1)        )    ),                                greaterOrEquals(length(basics('targetResourceId')), 1)                                )]",
                    "message": "The value must have a length of at least 1."
                  }
                ]
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "targetResourceRegion",
              "type": "Microsoft.Common.TextBox",
              "label": "Target Resource Region",
              "subLabel": "",
              "defaultValue": "",
              "toolTip": "Azure region in which target resources to be monitored are in (without spaces). For example: EastUS",
              "constraints": {
                "required": true,
                "regex": "",
                "validationMessage": "",
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "targetResourceType",
              "type": "Microsoft.Common.TextBox",
              "label": "Target Resource Type",
              "subLabel": "",
              "defaultValue": "",
              "toolTip": "Resource type of target resources to be monitored.",
              "constraints": {
                "required": true,
                "regex": "",
                "validationMessage": "",
                "validations": [
                  {
                    "isValid": "[or(                                or(    empty(basics('targetResourceType')),     and(        not(startsWith(basics('targetResourceType'), '[[')),         startsWith(basics('targetResourceType'), '['), endsWith(basics('targetResourceType'), ']'),         greater(indexOf(basics('targetResourceType'), '('), -1), greater(indexOf(basics('targetResourceType'), ')'), -1)        )    ),                                greaterOrEquals(length(basics('targetResourceType')), 1)                                )]",
                    "message": "The value must have a length of at least 1."
                  }
                ]
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "isEnabled",
              "type": "Microsoft.Common.DropDown",
              "label": "Is Enabled",
              "subLabel": "",
              "defaultValue": "true",
              "toolTip": "Specifies whether the alert is enabled",
              "constraints": {
                "required": false,
                "allowedValues": [
                  {
                    "label": "true",
                    "value": true
                  },
                  {
                    "label": "false",
                    "value": false
                  }
                ],
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "alertSeverity",
              "type": "Microsoft.Common.DropDown",
              "label": "Alert Severity",
              "subLabel": "",
              "defaultValue": "3",
              "toolTip": "Severity of alert {0,1,2,3,4}",
              "constraints": {
                "required": false,
                "allowedValues": [
                  {
                    "label": "0",
                    "value": "0"
                  },
                  {
                    "label": "1",
                    "value": "1"
                  },
                  {
                    "label": "2",
                    "value": "2"
                  },
                  {
                    "label": "3",
                    "value": "3"
                  },
                  {
                    "label": "4",
                    "value": "4"
                  }
                ],
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "operator",
              "type": "Microsoft.Common.DropDown",
              "label": "Operator",
              "subLabel": "",
              "defaultValue": "GreaterThan",
              "toolTip": "Operator comparing the current value with the threshold value.",
              "constraints": {
                "required": false,
                "allowedValues": [
                  {
                    "label": "Equals",
                    "value": "Equals"
                  },
                  {
                    "label": "GreaterThan",
                    "value": "GreaterThan"
                  },
                  {
                    "label": "GreaterThanOrEqual",
                    "value": "GreaterThanOrEqual"
                  },
                  {
                    "label": "LessThan",
                    "value": "LessThan"
                  },
                  {
                    "label": "LessThanOrEqual",
                    "value": "LessThanOrEqual"
                  }
                ],
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "threshold",
              "type": "Microsoft.Common.TextBox",
              "label": "Threshold",
              "subLabel": "",
              "defaultValue": "8000000000",
              "toolTip": "The threshold value at which the alert is activated.",
              "constraints": {
                "required": false,
                "regex": "",
                "validationMessage": "",
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "timeAggregation",
              "type": "Microsoft.Common.DropDown",
              "label": "Time Aggregation",
              "subLabel": "",
              "defaultValue": "Maximum",
              "toolTip": "How the data that is collected should be combined over time.",
              "constraints": {
                "required": false,
                "allowedValues": [
                  {
                    "label": "Average",
                    "value": "Average"
                  },
                  {
                    "label": "Minimum",
                    "value": "Minimum"
                  },
                  {
                    "label": "Maximum",
                    "value": "Maximum"
                  },
                  {
                    "label": "Total",
                    "value": "Total"
                  },
                  {
                    "label": "Count",
                    "value": "Count"
                  }
                ],
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "windowSize",
              "type": "Microsoft.Common.DropDown",
              "label": "Window Size",
              "subLabel": "",
              "defaultValue": "PT5M",
              "toolTip": "Period of time used to monitor alert activity based on the threshold. Must be between one minute and one day. ISO 8601 duration format.",
              "constraints": {
                "required": false,
                "allowedValues": [
                  {
                    "label": "PT1M",
                    "value": "PT1M"
                  },
                  {
                    "label": "PT5M",
                    "value": "PT5M"
                  },
                  {
                    "label": "PT15M",
                    "value": "PT15M"
                  },
                  {
                    "label": "PT30M",
                    "value": "PT30M"
                  },
                  {
                    "label": "PT1H",
                    "value": "PT1H"
                  },
                  {
                    "label": "PT6H",
                    "value": "PT6H"
                  },
                  {
                    "label": "PT12H",
                    "value": "PT12H"
                  },
                  {
                    "label": "PT24H",
                    "value": "PT24H"
                  },
                  {
                    "label": "PT1D",
                    "value": "PT1D"
                  }
                ],
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "evaluationFrequency",
              "type": "Microsoft.Common.DropDown",
              "label": "Evaluation Frequency",
              "subLabel": "",
              "defaultValue": "PT5M",
              "toolTip": "how often the metric alert is evaluated represented in ISO 8601 duration format",
              "constraints": {
                "required": false,
                "allowedValues": [
                  {
                    "label": "PT1M",
                    "value": "PT1M"
                  },
                  {
                    "label": "PT5M",
                    "value": "PT5M"
                  },
                  {
                    "label": "PT15M",
                    "value": "PT15M"
                  },
                  {
                    "label": "PT30M",
                    "value": "PT30M"
                  },
                  {
                    "label": "PT1H",
                    "value": "PT1H"
                  }
                ],
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "currentDateTimeUtcNow",
              "type": "Microsoft.Common.TextBox",
              "label": "Current Date Time Utc Now",
              "subLabel": "",
              "defaultValue": "[[utcNow()]",
              "toolTip": "The current date and time using the utcNow function. Used for deployment name uniqueness",
              "constraints": {
                "required": false,
                "regex": "",
                "validationMessage": "",
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "telemetryOptOut",
              "type": "Microsoft.Common.DropDown",
              "label": "Telemetry Opt Out",
              "subLabel": "",
              "defaultValue": "No",
              "toolTip": "The customer usage identifier used for telemetry purposes. The default value of False enables telemetry. The value of True disables telemetry.",
              "constraints": {
                "required": false,
                "allowedValues": [
                  {
                    "label": "Yes",
                    "value": "Yes"
                  },
                  {
                    "label": "No",
                    "value": "No"
                  }
                ],
                "validations": []
              },
              "infoMessages": [],
              "visible": true
            },
            {
              "name": "resourceScope",
              "type": "Microsoft.Common.ResourceScope"
            },
            {
              "name": "getLocations",
              "type": "Microsoft.Solutions.ArmApiControl",
              "request": {
                "method": "GET",
                "path": "locations?api-version=2019-11-01"
              }
            }
          ]
        }
      ]
    },
    "outputs": {
      "resourceGroupId": "test",
      "parameters": {
        "alertName": "[steps('monitor').alertName]",
        "alertDescription": "[steps('monitor').alertDescription]",
        "targetResourceId": "[steps('monitor').targetResourceId]",
        "targetResourceRegion": "[steps('monitor').targetResourceRegion]",
        "targetResourceType": "[steps('monitor').targetResourceType]",
        "isEnabled": "[steps('monitor').isEnabled]",
        "alertSeverity": "[steps('monitor').alertSeverity]",
        "operator": "[steps('monitor').operator]",
        "threshold": "[steps('monitor').threshold]",
        "timeAggregation": "[steps('monitor').timeAggregation]",
        "windowSize": "[steps('monitor').windowSize]",
        "evaluationFrequency": "[steps('monitor').evaluationFrequency]",
        "currentDateTimeUtcNow": "[steps('monitor').currentDateTimeUtcNow]",
        "telemetryOptOut": "[steps('monitor').telemetryOptOut]"
      },
      "kind": "ResourceGroup",
      "location": "swedencentral"
    }
  }
}
